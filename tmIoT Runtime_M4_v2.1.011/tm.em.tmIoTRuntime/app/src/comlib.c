/*==============================================================================+
|  Function : comlib.c                                                     		|
|  Task     : Source File                                                       |
|-------------------------------------------------------------------------------|
|  Compile  :                                                                   |
|  Link     :                                                                   |
|  Call     :                                                                   |
|-------------------------------------------------------------------------------|
|  Author   : YW                                                                |
|  Version  : V2.00                                                             |
|  Creation : 2018/01/19                                                        |
|  Revision :                                                                   |
+==============================================================================*/

#include "comlib.h"
/*===========================================================================+
|           Constant                                                         |
+===========================================================================*/
/*===========================================================================+
|           Type definition                                                  |
+===========================================================================*/
/*===========================================================================+
|           Constructor and destructor                                       |
+===========================================================================*/
/*===========================================================================+
|           Helpers  Implement                                               |
+===========================================================================*/
/*===========================================================================+
|           Global variable                                                  |
+===========================================================================*/
/*===========================================================================+
|Name:         wtob_L                                             		     |
|Description:  Get low byte of word    										 |
+===========================================================================*/
BYTE_T wtob_L( WORD_T n)
{
	return n & 0x00FF;
}
/*===========================================================================+
|Name:         wtob_H		                                                 |
|Description:  Get high byte of word     									 |
+===========================================================================*/
BYTE_T wtob_H( WORD_T n)
{
    return (n & 0xFF00) >> 8;
}
/*===========================================================================+
|Name:         btow			                                                 |
|Description:  Merge two bytes into a word								     |
+===========================================================================*/
WORD_T btow(BYTE_T a, BYTE_T b)
{
    WORD_T w;
    w = a << 8 | b;
    return w;
}
/*===========================================================================+
|Name:         CRC_check	                                                 |
|Description:  Get CRC-16												     |
+===========================================================================*/
WORD_T CRC_check(BYTE_T *data, BYTE_T length)
{
	WORD_T mid = 0;
	WORD_T CRC = 0xFFFF;
	WORD_T times = 0, index = 0;

	while (length)
	{
		CRC = data[index]^CRC;
		for (times = 0; times < 8; times++)
		{
			mid = CRC;
			CRC = CRC>>1;
			if (mid&0x0001)
				CRC = CRC^0xA001;
		}
		index++;
		length--;
	}
	return CRC;
}
/*===========================================================================+
|Name:         fetchWORD_T                                                   |
|Description:  Get WORD_T (2 BYTE_T) result value from data				     |
+===========================================================================*/
WORD_T fetchWORD_T(BYTE_T *data, int offset)
{
	WORD_T wData;

	wData = (((data[offset] & 0xFF) << 8) | (data[offset+1] & 0xFF));

	return wData;
}
/*===========================================================================+
|Name:         fetchdWORD_T                                                  |
|Description:  Get double WORD_T (4 BYTE_T) result value from data			 |
+===========================================================================*/
DWORD_T fetchdWORD_T(BYTE_T *data, int offset)
{
	DWORD_T dwData;

	dwData = (((data[offset] & 0xFF) << 24) |
             ((data[offset+1] & 0xFF) << 16) |
             ((data[offset+2] & 0xFF) << 8) |
             (data[offset+3] & 0xFF));

	return dwData;
}
/*===========================================================================+
|Name:         dwtow_L                                                  	 |
|Description:  																 |
+===========================================================================*/
WORD dwtow_L(DWORD dwValue)
{
	return dwValue & 0x0000FFFF;
}
/*===========================================================================+
|Name:         dwtow_H                                               	     |
|Description:  																 |
+===========================================================================*/
WORD dwtow_H(DWORD dwValue)
{
	return (dwValue & 0xFFFF000) >> 16;
}
/*===========================================================================+
|Name:         htons                                               	     |
|Description:  																 |
+===========================================================================*/
WORD htons(WORD n)
{
	return ((n & 0xff) << 8) | ((n & 0xff00) >> 8);
}
/*===========================================================================+
|Name:         htonl                                               	     |
|Description:  																 |
+===========================================================================*/
DWORD htonl(DWORD n)
{
        return ((n & 0xff) << 24) |
        ((n & 0xff00) << 8) |
        ((n & 0xff0000UL) >> 8) |
        ((n & 0xff000000UL) >> 24);
}
/*-------------------------------------------------------------------------------------------------+
|                              END                                                                 |
+-------------------------------------------------------------------------------------------------*/
